<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ninja Projects Showcase</title>

  <!-- Code Ninjas-style modern font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />
</head>
<body class="container">
  <div class="app-shell">
    <header class="header">
      <div class="header-top">
        <div class="brand">
          <div class="brand-logo" aria-hidden="true">CN</div>
          <div class="brand-text">
            <span class="brand-title">Code Ninjas</span>
            <span class="brand-subtitle">Student Game Gallery</span>
          </div>
        </div>

        <div class="header-meta">
          <span id="project-count" class="project-count">0 projects</span>
        </div>
      </div>

      <div class="header-bottom">
        <h1>Ninja Projects Showcase</h1>
        <p class="subtitle">
          Discover and play games built in MakeCode Arcade by Code Ninjas students.
        </p>

        <div class="toolbar">
          <label class="search">
            <span class="search-icon" aria-hidden="true">üîç</span>
            <input
              id="search-input"
              type="search"
              placeholder="Search by title or student‚Ä¶"
              aria-label="Search projects by title or student"
            />
          </label>

          <div class="toolbar-right">
            <div class="pill-group" id="genre-filters" aria-label="Filter by genre"></div>

            <label class="select">
              <span class="select-label">Sort</span>
              <select id="sort-select" aria-label="Sort projects">
                <option value="title-asc">Title A‚ÄìZ</option>
                <option value="title-desc">Title Z‚ÄìA</option>
                <option value="student-asc">Student A‚ÄìZ</option>
              </select>
            </label>
          </div>
        </div>
      </div>
    </header>

    <main class="main">
      <ul id="project-list" class="project-list" aria-live="polite"></ul>
    </main>
  </div>

  <script>
    let allProjects = [];
    let currentSearch = '';
    let currentGenre = 'all';
    let currentSort = 'title-asc';

    function formatCount(count) {
      return count === 1 ? '1 project' : `${count} projects`;
    }

    function renderGenreFilters(genres) {
      const container = document.getElementById('genre-filters');
      container.innerHTML = '';

      const makePill = (value, label) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = label;
        btn.className = 'pill' + (value === currentGenre ? ' pill--active' : '');
        btn.setAttribute('data-value', value);
        btn.addEventListener('click', () => {
          currentGenre = value;
          renderProjects();
        });
        return btn;
      };

      // "All" first
      container.appendChild(makePill('all', 'All'));

      genres.forEach((g) => {
        container.appendChild(makePill(g, g));
      });
    }

    function renderProjects(options = {}) {
      if (options.search !== undefined) currentSearch = options.search;
      if (options.genre !== undefined) currentGenre = options.genre;
      if (options.sort !== undefined) currentSort = options.sort;

      const list = document.getElementById('project-list');
      const countEl = document.getElementById('project-count');
      const query = currentSearch.trim().toLowerCase();

      let visible = [...allProjects];

      // Text search
      if (query) {
        visible = visible.filter((proj) =>
          proj.project.toLowerCase().includes(query) ||
          proj.student.toLowerCase().includes(query)
        );
      }

      // Genre filter
      if (currentGenre !== 'all') {
        visible = visible.filter((proj) => proj.genre === currentGenre);
      }

      // Sorting
      visible.sort((a, b) => {
        if (currentSort === 'title-asc') {
          return a.project.localeCompare(b.project);
        }
        if (currentSort === 'title-desc') {
          return b.project.localeCompare(a.project);
        }
        if (currentSort === 'student-asc') {
          return a.student.localeCompare(b.student);
        }
        return 0;
      });

      list.innerHTML = '';

      if (!visible.length) {
        const message = allProjects.length === 0
          ? 'No projects yet ‚Äî check back soon!'
          : `No matches for your filters.`;
        list.innerHTML = `<li class="empty">${message}</li>`;
        countEl.textContent = formatCount(0);
        return;
      }

      visible.forEach((proj) => {
        const li = document.createElement('li');
        li.className = 'project-card';
        li.innerHTML = `
          <a class="project-link" href="project.html?id=${proj.id}">
            <div class="project-tag">${proj.genre || 'Game'}</div>
            <h2>${proj.project}</h2>
            <p class="project-student">By ${proj.student}</p>
          </a>
        `;
        list.appendChild(li);
      });

      countEl.textContent = formatCount(visible.length);
    }

    async function loadProjects() {
      const response = await fetch('projects.json');
      const projects = await response.json();

      // Keep index for link, add genre with fallback
      allProjects = projects.map((proj, index) => ({
        id: index,
        genre: proj.genre || 'Other',
        ...proj
      }));

      const genres = Array.from(
        new Set(allProjects.map((p) => p.genre || 'Other'))
      ).sort((a, b) => a.localeCompare(b));

      renderGenreFilters(genres);
      renderProjects();
    }

    document.addEventListener('DOMContentLoaded', () => {
      const searchInput = document.getElementById('search-input');
      const sortSelect = document.getElementById('sort-select');

      searchInput.addEventListener('input', (event) => {
        renderProjects({ search: event.target.value });
      });

      searchInput.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          event.target.value = '';
          renderProjects({ search: '' });
          event.target.blur();
        }
      });

      sortSelect.addEventListener('change', (event) => {
        renderProjects({ sort: event.target.value });
      });

      loadProjects();
    });
  </script>
</body>
</html>
